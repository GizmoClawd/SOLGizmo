<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GIZMO â€” Live P&L Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<style>
:root {
  --bg: #0a0a0f;
  --panel: #12121a;
  --border: #2a2a3a;
  --green: #00ff41;
  --red: #ff3355;
  --yellow: #ffcc00;
  --cyan: #00ccff;
  --dim: #555570;
  --text: #e0e0f0;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { background:var(--bg); color:var(--text); font-family:'Press Start 2P',monospace; font-size:10px; line-height:1.8; min-height:100vh; }
.container { max-width:1100px; margin:0 auto; padding:12px; }
header { display:flex; justify-content:space-between; align-items:center; padding:10px 0 14px; border-bottom:2px solid var(--border); margin-bottom:14px; }
header h1 { font-size:14px; color:var(--green); }
header .status { color:var(--dim); font-size:8px; }
header .status.live { color:var(--green); }
.top-stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:10px; margin-bottom:14px; }
.stat-card { background:var(--panel); border:1px solid var(--border); padding:12px; }
.stat-card .label { font-size:7px; color:var(--dim); margin-bottom:6px; text-transform:uppercase; letter-spacing:1px; }
.stat-card .value { font-size:16px; color:var(--text); }
.stat-card .value.green { color:var(--green); }
.stat-card .value.red { color:var(--red); }
.stat-card .sub { font-size:7px; color:var(--dim); margin-top:4px; }
.chart-wrap { background:var(--panel); border:1px solid var(--border); padding:14px; margin-bottom:14px; position:relative; }
.chart-wrap h2 { font-size:9px; color:var(--cyan); margin-bottom:10px; }
.chart-container { position:relative; width:100%; height:320px; }
.positions { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:10px; margin-bottom:14px; }
.pos-card { background:var(--panel); border:1px solid var(--border); padding:12px; }
.pos-card .token-name { font-size:11px; color:var(--yellow); margin-bottom:8px; }
.pos-card .row { display:flex; justify-content:space-between; margin-bottom:4px; }
.pos-card .row .k { color:var(--dim); font-size:8px; }
.pos-card .row .v { font-size:8px; }
.pos-card .pnl-bar { height:4px; background:#1a1a2a; margin-top:8px; border-radius:2px; overflow:hidden; }
.pos-card .pnl-bar .fill { height:100%; transition:width .5s; }
.trades-log { background:var(--panel); border:1px solid var(--border); padding:12px; }
.trades-log h2 { font-size:9px; color:var(--cyan); margin-bottom:10px; }
.trades-log table { width:100%; border-collapse:collapse; }
.trades-log th { text-align:left; font-size:7px; color:var(--dim); padding:4px 6px; border-bottom:1px solid var(--border); }
.trades-log td { font-size:8px; padding:4px 6px; border-bottom:1px solid #1a1a22; }
footer { text-align:center; padding:16px 0 8px; font-size:7px; color:var(--dim); }
footer a { color:var(--cyan); text-decoration:none; }
.wallet-addr { font-size:7px; color:var(--dim); word-break:break-all; }
@media(max-width:600px){
  .chart-container { height:220px; }
  .stat-card .value { font-size:13px; }
  header h1 { font-size:11px; }
}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>ðŸŽ® GIZMO P&L</h1>
    <div class="status" id="status">CONNECTING...</div>
  </header>

  <div class="top-stats">
    <div class="stat-card">
      <div class="label">Portfolio Value</div>
      <div class="value" id="portSol">--</div>
      <div class="sub" id="portUsd">--</div>
    </div>
    <div class="stat-card">
      <div class="label">Total P&L</div>
      <div class="value" id="totalPnl">--</div>
      <div class="sub" id="totalPnlPct">--</div>
    </div>
    <div class="stat-card">
      <div class="label">Wallet Balance</div>
      <div class="value" id="walletBal">--</div>
      <div class="sub" id="walletUsd">--</div>
    </div>
    <div class="stat-card">
      <div class="label">SOL Price</div>
      <div class="value" id="solPrice">--</div>
      <div class="sub">via DexScreener</div>
    </div>
  </div>

  <div class="chart-wrap">
    <h2>ðŸ“ˆ PORTFOLIO VALUE (SOL)</h2>
    <div class="chart-container"><canvas id="pnlChart"></canvas></div>
  </div>

  <div class="positions" id="positions"></div>

  <div class="trades-log">
    <h2>ðŸ“‹ TRADE LOG</h2>
    <table>
      <thead><tr><th>DATE</th><th>TYPE</th><th>TOKEN</th><th>SOL</th><th>STATUS</th></tr></thead>
      <tbody>
        <tr><td>02-18</td><td style="color:var(--green)">BUY</td><td>$GIZMO</td><td>15</td><td>HOLDING</td></tr>
        <tr><td>02-19</td><td style="color:var(--green)">BUY</td><td>$PUNCH</td><td>8</td><td>HOLDING</td></tr>
        <tr><td>02-19</td><td style="color:var(--yellow)">SWAP</td><td>USDC</td><td>20</td><td>DEPLOYED</td></tr>
      </tbody>
    </table>
  </div>

  <footer>
    <div>WALLET: <span class="wallet-addr">FXdMNyRo5CqfG3yRWCcNu163FpnSusdZSYecsB76GAkn</span></div>
    <div style="margin-top:6px"><a href="https://solscan.io/account/FXdMNyRo5CqfG3yRWCcNu163FpnSusdZSYecsB76GAkn" target="_blank">View on Solscan</a></div>
  </footer>
</div>

<script>
const WALLET = 'FXdMNyRo5CqfG3yRWCcNu163FpnSusdZSYecsB76GAkn';
const RPC = 'https://api.mainnet-beta.solana.com';
const POSITIONS = [
  { token:'$GIZMO', ca:'8HGer4vRWZMu5MUYU7ACPb4uanKgBewaXJZscLagpump', invested:15 },
  { token:'$PUNCH', ca:'NV2RYH954cTJ3ckFUpvfqaQXU4ARqqDH3562nFSpump', invested:8 },
];
const USDC_DEPLOYED = 20;
const TOTAL_INVESTED = POSITIONS.reduce((s,p)=>s+p.invested,0) + USDC_DEPLOYED;

let solPriceUsd = 0;

const ctx = document.getElementById('pnlChart').getContext('2d');
const gradient = ctx.createLinearGradient(0,0,0,320);
gradient.addColorStop(0,'rgba(0,255,65,0.15)');
gradient.addColorStop(1,'rgba(0,255,65,0)');

const chart = new Chart(ctx, {
  type:'line',
  data:{ labels:[], datasets:[{
    data:[], borderColor:'#00ff41', borderWidth:2, pointRadius:0,
    fill:true, backgroundColor:gradient, tension:0.3
  }]},
  options:{
    responsive:true, maintainAspectRatio:false,
    animation:{ duration:400 },
    scales:{
      x:{ display:true, ticks:{ color:'#555570', font:{family:"'Press Start 2P'",size:7}, maxTicksLimit:8 }, grid:{color:'#1a1a2a'} },
      y:{ display:true, ticks:{ color:'#555570', font:{family:"'Press Start 2P'",size:7}, callback:v=>v.toFixed(1) }, grid:{color:'#1a1a2a'} }
    },
    plugins:{ legend:{display:false}, tooltip:{ titleFont:{family:"'Press Start 2P'",size:8}, bodyFont:{family:"'Press Start 2P'",size:8} } }
  }
});

function timeLabel(){
  const d=new Date(); return d.toLocaleTimeString('en',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false});
}

async function fetchJSON(url, opts){
  try { const r=await fetch(url,opts); if(!r.ok) throw r.status; return await r.json(); }
  catch(e){ console.warn('fetch err',url,e); return null; }
}

async function getSolBalance(){
  const d=await fetchJSON(RPC,{method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({jsonrpc:'2.0',id:1,method:'getBalance',params:[WALLET]})});
  return d?.result?.value!=null ? d.result.value/1e9 : null;
}

async function getTokenPrices(){
  const prices = {};
  for(const p of POSITIONS){
    const d = await fetchJSON(`https://api.dexscreener.com/latest/dex/tokens/${p.ca}`);
    if(d?.pairs?.length){
      const pair = d.pairs[0];
      prices[p.ca] = { priceUsd:parseFloat(pair.priceUsd||0), priceNative:parseFloat(pair.priceNative||0),
        fdv:pair.fdv||0, liq:pair.liquidity?.usd||0, vol24:pair.volume?.h24||0 };
      if(!solPriceUsd && pair.priceUsd && pair.priceNative)
        solPriceUsd = parseFloat(pair.priceUsd)/parseFloat(pair.priceNative);
    }
  }
  if(!solPriceUsd){
    const sd=await fetchJSON('https://api.dexscreener.com/latest/dex/tokens/So11111111111111111111111111111111111111112');
    if(sd?.pairs?.length) solPriceUsd=parseFloat(sd.pairs[0].priceUsd||0);
  }
  return prices;
}

async function getTokenBalances(){
  const d = await fetchJSON(RPC, {method:'POST', headers:{'Content-Type':'application/json'},
    body:JSON.stringify({jsonrpc:'2.0',id:1,method:'getTokenAccountsByOwner',
      params:[WALLET,{programId:'TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA'},
        {encoding:'jsonParsed'}]})});
  const balances = {};
  if(d?.result?.value){
    for(const acct of d.result.value){
      const info = acct.account.data.parsed.info;
      balances[info.mint] = parseFloat(info.tokenAmount.uiAmountString||0);
    }
  }
  return balances;
}

function colorClass(v){ return v>=0?'green':'red'; }
function fmt(v,d=2){ return v>=0?`+${v.toFixed(d)}`:v.toFixed(d); }

async function refresh(){
  const [walletBal, prices, tokenBals] = await Promise.all([getSolBalance(), getTokenPrices(), getTokenBalances()]);

  const statusEl=document.getElementById('status');
  statusEl.textContent='â— LIVE'; statusEl.className='status live';

  if(solPriceUsd) document.getElementById('solPrice').textContent=`$${solPriceUsd.toFixed(2)}`;

  if(walletBal!=null){
    document.getElementById('walletBal').textContent=`${walletBal.toFixed(4)} SOL`;
    document.getElementById('walletUsd').textContent=solPriceUsd?`â‰ˆ $${(walletBal*solPriceUsd).toFixed(2)}`:'';
  }

  let totalCurrentSol = walletBal||0;
  let posHtml='';

  for(const p of POSITIONS){
    const pr = prices[p.ca];
    const tokenBal = tokenBals[p.ca]||0;
    let currentValSol = p.invested;
    let pnlPct = 0;
    let priceStr = '--';
    let valStr = `${p.invested.toFixed(2)} SOL`;
    let extraInfo = '';

    if(pr && pr.priceNative>0 && tokenBal>0){
      currentValSol = tokenBal * pr.priceNative;
      pnlPct = ((currentValSol - p.invested)/p.invested)*100;
      priceStr = pr.priceUsd<0.001?`$${pr.priceUsd.toExponential(2)}`:`$${pr.priceUsd.toFixed(6)}`;
      valStr = `${currentValSol.toFixed(2)} SOL`;
      extraInfo = `FDV $${(pr.fdv/1000).toFixed(0)}K Â· VOL $${(pr.vol24/1000).toFixed(0)}K`;
    } else if(pr && pr.priceNative>0){
      priceStr = pr.priceUsd<0.001?`$${pr.priceUsd.toExponential(2)}`:`$${pr.priceUsd.toFixed(6)}`;
      extraInfo = `FDV $${(pr.fdv/1000).toFixed(0)}K`;
    }

    totalCurrentSol += currentValSol;
    const pnlColor = pnlPct>=0?'var(--green)':'var(--red)';
    const barW = Math.min(Math.abs(pnlPct),100);

    posHtml += `<div class="pos-card">
      <div class="token-name">${p.token}</div>
      <div class="row"><span class="k">Price</span><span class="v">${priceStr}</span></div>
      <div class="row"><span class="k">Invested</span><span class="v">${p.invested} SOL</span></div>
      <div class="row"><span class="k">Value</span><span class="v">${valStr}</span></div>
      <div class="row"><span class="k">P&L</span><span class="v" style="color:${pnlColor}">${fmt(pnlPct,1)}%</span></div>
      ${extraInfo?`<div class="row"><span class="k" style="font-size:6px">${extraInfo}</span></div>`:''}
      <div class="pnl-bar"><div class="fill" style="width:${barW}%;background:${pnlColor}"></div></div>
    </div>`;
  }

  posHtml += `<div class="pos-card">
    <div class="token-name">USDC (Prediction Markets)</div>
    <div class="row"><span class="k">Deployed</span><span class="v">${USDC_DEPLOYED} SOL</span></div>
    <div class="row"><span class="k">Est. Value</span><span class="v">~$${solPriceUsd?(USDC_DEPLOYED*solPriceUsd).toFixed(0):'--'} USDC</span></div>
    <div class="row"><span class="k">Status</span><span class="v" style="color:var(--yellow)">ACTIVE</span></div>
  </div>`;

  document.getElementById('positions').innerHTML = posHtml;
  totalCurrentSol += USDC_DEPLOYED;

  const totalPnlSol = totalCurrentSol - TOTAL_INVESTED;
  const totalPnlPct = (totalPnlSol/TOTAL_INVESTED)*100;

  document.getElementById('portSol').textContent = `${totalCurrentSol.toFixed(2)} SOL`;
  document.getElementById('portUsd').textContent = solPriceUsd?`â‰ˆ $${(totalCurrentSol*solPriceUsd).toFixed(2)}`:'';

  const pnlEl = document.getElementById('totalPnl');
  pnlEl.textContent = `${fmt(totalPnlSol)} SOL`;
  pnlEl.className = `value ${colorClass(totalPnlSol)}`;
  document.getElementById('totalPnlPct').textContent = `${fmt(totalPnlPct,1)}%${solPriceUsd?` Â· $${fmt(totalPnlSol*solPriceUsd)}`:''}`;

  // Update chart
  chart.data.labels.push(timeLabel());
  chart.data.datasets[0].data.push(totalCurrentSol);
  if(chart.data.labels.length>120){ chart.data.labels.shift(); chart.data.datasets[0].data.shift(); }
  const c = totalPnlSol>=0?'#00ff41':'#ff3355';
  chart.data.datasets[0].borderColor=c;
  const g=ctx.createLinearGradient(0,0,0,320);
  g.addColorStop(0, totalPnlSol>=0?'rgba(0,255,65,0.15)':'rgba(255,51,85,0.15)');
  g.addColorStop(1,'transparent');
  chart.data.datasets[0].backgroundColor=g;
  chart.update('none');
}

refresh();
setInterval(refresh, 15000);
</script>
</body>
</html>
